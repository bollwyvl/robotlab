parameters:
  name: Linux
  vmImage: ubuntu-16.04
  activate: ""
  product: MiniRobot

jobs:
  - job: ${{ parameters.product }}${{ parameters.name }}Build
    condition: succeeded()
    pool:
      vmImage: ${{ parameters.vmImage }}

    steps:
      - template: steps.conda.yml
        parameters:
          name: ${{ parameters.name }}
          envPath: ci/env-main.yml

      - script: ${{ parameters.activate }} python -m scripts.build constructor ${{ parameters.product }}
        displayName: build installer

      - ${{ if eq(parameters.name, 'MacOSX') }}:
        - script: chmod -R 777 _artifacts
          displayName: fix artifact permissions

      - task: PublishPipelineArtifact@1
        displayName: publish installer
        inputs:
          targetPath: _artifacts/constructor
          artifactName: ${{ parameters.product }} for ${{ parameters.name }}
        condition: succeeded()
